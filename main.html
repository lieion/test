<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">

    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-legend/2.25.6/d3-legend.min.js"></script>
    <script src="https://unpkg.com/@popperjs/core@2"></script>
    <script src="components/piechart.js"></script>

    <title>My Scatterplot</title>
    <style>
        body {
            background: #eee;
            overflow-y: scroll;
        }

        .container {
            width: 800px;
            background: white;
        }

        .brushed {
            stroke-width: 1;
            stroke: gray;
            r: 5;
        }
    </style>
</head>

<body>
    <main class="container pb-3">
        <div class="row pt-2">
            <div class="col-1 text-end pe-2"><strong>Year:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="2017" id="y-2017">
                    <label class="form-check-label" for="x-sl">2017</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="2018" id="y-2018" checked>
                    <label class="form-check-label" for="x-sw">2018</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="2019" id="y-2019">
                    <label class="form-check-label" for="x-pl">2019</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="2020" id="y-2020">
                    <label class="form-check-label" for="x-pw">2020</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="2021" id="y-2021">
                    <label class="form-check-label" for="x-pw">2021</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="2022" id="y-2022">
                    <label class="form-check-label" for="x-pw">2022</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="y-encoding" value="all" id="y-0">
                    <label class="form-check-label" for="x-pw">All</label>
                </div>
            </div>

        </div>
        <div class="row">
            <div class="col-1 text-end pe-2"><strong>Month:</strong></div>
            <div class="col-11">
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="1" id="m-jan"
                        checked>
                    <label class="form-check-label" for="y-sw">1月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="2" id="m-feb">
                    <label class="form-check-label" for="y-pl">2月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="3" id="m-mar">
                    <label class="form-check-label" for="y-pw">3月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="4" id="m-apr">
                    <label class="form-check-label" for="y-pw">4月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="5" id="m-may">
                    <label class="form-check-label" for="y-pw">5月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="6" id="m-jun">
                    <label class="form-check-label" for="y-pw">6月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="7" id="m-jul">
                    <label class="form-check-label" for="y-pw">7月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="8" id="m-aug">
                    <label class="form-check-label" for="y-pw">8月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="9" id="m-sep">
                    <label class="form-check-label" for="y-pw">9月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="10" id="m-oct">
                    <label class="form-check-label" for="y-pw">10月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="11" id="m-nov">
                    <label class="form-check-label" for="y-pw">11月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="12" id="m-dec">
                    <label class="form-check-label" for="y-pw">12月</label>
                </div>
                <div class="form-check form-check-inline">
                    <input class="form-check-input" type="radio" name="m-encoding" value="0" id="m-all">
                    <label class="form-check-label" for="y-pw">All</label>
                </div>

            </div>
        </div>
        <div class="text-center">
            <svg width="400" height="400" id="piechart">
            </svg>
            <div class="tooltip bs-tooltip-top show" id="pc-tooltip" role="tooltip" style="display:none">
                <div class="tooltip-arrow"></div>
                <div class="tooltip-inner">
                    Some tooltip text!
                </div>
            </div>

        </div>
    </main>
    <script>
        let data,piechart,clickedLines;
        let clickedNum=0;
        function updatePieChart() {
            let yVar = d3.select("input[type=radio][name=y-encoding]:checked").property("value");
            let mVar = d3.select("input[type=radio][name=m-encoding]:checked").property("value");
            piechart.update(yVar, mVar);
        }

        function updateSubHistogram(){
            histogram.update(clickedLines,yVar,mVar);
        }

        
        //derive csv from github save
        Promise.all([
            d3.csv("https://raw.githubusercontent.com/lieion/test/main/src/subway_2017.csv"),
            d3.csv("https://raw.githubusercontent.com/lieion/test/main/src/subway_2018.csv"),
            d3.csv("https://raw.githubusercontent.com/lieion/test/main/src/subway_2019.csv"),
            d3.csv("https://raw.githubusercontent.com/lieion/test/main/src/subway_2020.csv"),
            d3.csv("https://raw.githubusercontent.com/lieion/test/main/src/subway_2021.csv"),
            d3.csv("https://raw.githubusercontent.com/lieion/test/main/src/subway_2022.csv"),
        ])
        .then(csvData => {
            csvData.forEach(f => {
                f.forEach(d=>{
                    d["05~06"] = +d["05~06"];
                    d["06~07"] = +d["06~07"];
                    d["07~08"] = +d["07~08"];
                    d["08~09"] = +d["08~09"];
                    d["09~10"] = +d["09~10"];
                    d["10~11"] = +d["10~11"];
                    d["11~12"] = +d["11~12"];
                    d["12~13"] = +d["12~13"];
                    d["13~14"] = +d["13~14"];
                    d["14~15"] = +d["14~15"];
                    d["15~16"] = +d["15~16"];
                    d["16~17"] = +d["16~17"];
                    d["17~18"] = +d["17~18"];
                    d["18~19"] = +d["18~19"];
                    d["19~20"] = +d["19~20"];
                    d["20~21"] = +d["20~21"];
                    d["21~22"] = +d["21~22"];
                    d["22~23"] = +d["22~23"];
                    d["23~24"] = +d["23~24"];
                    d["24~01"] = +d["24~01"];
                    d["Total"] = +d["Total"];
                });
            });
            data = csvData;
            piechart = new PieChart("#piechart", "#pc-tooltip", data);
            piechart.initialize();

            updatePieChart();
            d3.selectAll("input[type=radio][name=y-encoding]").on("change", updatePieChart);
            d3.selectAll("input[type=radio][name=m-encoding]").on("change", updatePieChart);

            piechart.on("click", (clickedItems) => {
                clickedLines=clickedItems;
                console.log(clickedLines);
                //updateSubHistogram()
            });
        });
        
        
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p"
        crossorigin="anonymous"></script>
</body>

</html>